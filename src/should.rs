// Copyright 2022 Aztec
// Copyright 2025 Horizen Labs, Inc.
// SPDX-License-Identifier: Apache-2.0 or MIT

// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// 	http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

use crate::*;
use alloc::boxed::Box;
use ark_ff::PrimeField;
use rstest::{fixture, rstest};
// use sha3::{digest::Update, Digest, Keccak256};

#[fixture]
fn valid_zk_proof() -> Box<[u8]> {
    Box::new(hex_literal::hex!("0000000000000000000000000000000000000000000000042ab5d6d1986846cf00000000000000000000000000000000000000000000000b75c020998797da780000000000000000000000000000000000000000000000005a107acb64952eca000000000000000000000000000000000000000000000000000031e97a575e9d00000000000000000000000000000000000000000000000b5666547acf8bd5a400000000000000000000000000000000000000000000000c410db10a01750aeb00000000000000000000000000000000000000000000000d722669117f9758a4000000000000000000000000000000000000000000000000000178cbf4206471000000000000000000000000000000000000000000000000e91b8a11e7842c38000000000000000000000000000000000000000000000007fd51009034b3357f000000000000000000000000000000000000000000000009889939f81e9c74020000000000000000000000000000000000000000000000000000f94656a2ca48000000000000000000000000000000000000000000000006fb128b46c1ddb67f0000000000000000000000000000000000000000000000093fe27776f50224bd000000000000000000000000000000000000000000000004a0c80c0da527a0810000000000000000000000000000000000000000000000000001b52c2020d74620dbd39855da0aa548efa88e9121c530a646b3ca56596742a69218cb4bff670a29326f97cc3576a3c23cd4ad5f23986b5d524a995cad2d34a9d0ca74591cba5d16652c79cc682038a0006b6f68d3d70f3f577125b5c714fafb9e9f6ef661310c0951fc2f821c85fb14ca27f5a32b19122e740045ca70f261cedf622c07e756f420725f498951a13bbc857a2b71cc149689fcad27c9580e16c5bf2d665da6969921dc363d97ce40779ed836753433894b9d5915699b8452c14683da36c92f63bf254892d851dc1b87abde9382e2645314f200907e4433e11d4fe1c51c29dd4537229f24a429b1594eb19810e6af69e0606d11570db1170da181d400af7abb8b280ee6a5bd135a17dff958fb78d97c1203653798c08baf86078941421f26a29387134b54989843b1d3627bc1fcf82f37b493316789a14c3883c62bc4855166317b13ee0b4fc9ecca5e8817912f6a91bcbe19a582849a6b1b1cba534226b97762a90801ab18a97fbad5577e56536354628708a6e51880f29eeaa4bc25c5944353a516faf00cd7dda6bf9ef9634d772ab29a9d50961c4a3e745ecd81436fdf66c06f2646325454cea518ebfa2f3cc4547e45dbf554addb1443cba9e489ddbc455c99258bff351061fc5d4e0553f63cd470933832112025a3290080fa96d846a7b2910b4368734ebec662d5e5dbfc1c2b9b3c83d0d0a3e6a7685b3a4c29984073588517880ff944921f65ddda1248d9ba177fc6f47b7ef624eebfbda447ee42199d75212e373ffa96c2a36841b2b0428c367a091166e5bf5fb9e400f1c073a554bb2a2f4abaca1d27b556f61ab045a7cbaa869d5332a28daace4f63a5000619fe12d7171e6ee5827b7d79bc893f7aa649138a9f3f343dcf56905c4aed9363e5f9dc96267880c1ca908505e734f7bd99ea71306ef21c985b513a22523ecfa5c1f612f1098b44b1507ba8db1d47e3125b281679d510972a84ddb88f57b679c2f69e6b8d268d0d8ffb1424f581378c4f07d9a709ccf6c5be13b8c99c4343886a0e51078a2edc537901834205f25b503c00aeabab11a2fe6b65b3647dff86027b9703c60d081b9ddeee3769f98d5f26e615e3cfba0d4a1a82d9d8ef356c6a74a7ff98f83d2e87e5b2b38b5fc5aded646157e1f89870f05421547a6776fa03afc00d5d093c03a7289456608694119f146c7a5cc5a662974dc04aaffeca44fa8b943dcf726a18a72fcb13b0fc5a70f570c43dd9764695919e8edaea9b6fbe6a9b74b3f9e379127e71676bca8980e2778cdc7a19fea79dcaf2f478f1d063b95889c7531da3051219c1a8ae910a0600b12c117c6864622e20c858cdd8ab2b163959c69d3c074b236b773bd38c15c98764ef57c0111f460d9d2c00777b3d05fdfa4716a7f798d129e112bbf1e66e828187c083d7cb847b8434d43ed02a63ffa5c9904a833031e40bf2110d7d458accaa14041b73e081dd7eec04ba804e1110632f1ca23444f88b2a02593dc3dbc57728f648b892c47227fa518d4dc68eb73a526d62468c64aac7221f9c92482f97948829168b4363ae03a4afad292adaab43fb48ed8cf88cc88013ff4b98fb2c1d79825a786d19d934bb1b1e22c4851d70a0214670debc9c06932894cd723607484505ab3040c04b86559db78a0d687a07a2a3fd20e5c3ff6094124f65fbbaaac103a605919deabb61f3f513dcfa50ab83edf422def51f6822cf1f46f0d081d14fed06f08636d9917074df1cc4209110140d55c2ad8133bffb7909a7763cfcdf85ec164f3ec40550f7f66e6b720ed670362fcc78c52c169d9a830f159b6cbecc00b2a1e7684b6e1c8da154367d3655de3941b14f14fb0b5749262d52975dd8517dc9d78256df9c8cda062fb8f12fc9f89d8fcb819962d0b41e701753ea823dc76ef98ca91b22f2f2c0f40fd4efa57384d030678f358c998c274217c8a0d3a0842ff07f2224b7b1394fb89ff5e5d352c4baf19be6ceaeecfce8f71c637ec0cb94ef3226216029f20be59776f815ad4e17416198b2e06b5145a36a130b1177666bb661e6553679ca980ae9dd39c861027b40b65183bd626c9a06d00a57c38debceff4e193cbea664a7fa0471d5d672d07609a5e53824035ad21f422be5f909819636ad4d8ff9a45983c6ee0bc6504f60f269855befe09eef8426230cb8d9ef9507048a70e210d26fbc82d1e2c6150ba7e12f29d1d65797e79fba681cd31ea298974bcdd66476230d4d56ef5ffc7813c4c8dc88a9396f08dd954503141c775cbe89141dcf9d21990ae5cc54fc0392a9164a6e57daafff48576ecd4b138f1fa72392f850a6c490a32d1487f38b78cf42b9d3d307e7206dc81a092963189d8c38a00b40a439278f86813dcc6dde7b18f3442e819304a72f489b0ccdb9106ca2de23064fad6b947c21bdb25a0e76f471afcc4e2727e5e8abee354c34da0f7cdef80041f8ce3222941e6e0d69646d9985b23ad3b76188c5086a0691c2900eac63911f622d709d02f1e64d3e0ec3fbee17e5b99b8b82a369a37fc163845529c29c1c2e5cf40953daba85ec793f41145ef7d7bc4e0cf87860df7cd98763b427e23fcf4ab3e97a21d524ea8b141a2d3a6476a44768e5c956a187036e3f5c371b68da77a0d8ae97761d4ca3ebd2ca1013ec60dfe9feda8190f077ae1654135219ce5c5a4cd9c5917e763541ff839942f3152d1ba1c7032a54bb829b123e72fa2366c13dd5096a74fe23f6b47f7d7e75781780646758be27ff4246c30bfef5250ebf028e8a1633463eb4cc4fe7e300d34ce8ca798115aceba14e0f2e7b57948919f43754f45052b8a2206e63c03645ea295e190c241f5bf32e7e066870e2e3410e49a82a18b0f22629f06d145bcbe05bfe18fcfd7ec405f3315dc6b8c5862b7613146a77b47a13bc203a69b2f5f7edf4dd4ab01d79fca800fdc2b0df80104d122ef16764145bf25c47e69399e44b966117db9b7bae7b05543b54b48176bad8e02fcdca252b870ed3bc2552db7a962808cfb250a7eb3fcb8e0404159f728cdbf01c1c48a1ddb3de7e9150985d30cacea7ddc5d2bed2eda6683b2d5b754adf576c267cb00d9a401a574b856eae4800dc220308226b3c4279599a42b5e7f8900a4a0694d05cfeec672ba9fe4b6bc92b68cd160e2bf2413d84263bbb4ab38e815e190686c1cffd21f48adadd7d7e71b40055d77b7ceab2d10dd745f9f79f2eead7811f6afffa14601b518b153a94f95f8213a96f8640c874d7da0f3b336b2ec9d5241feaa74f3320acffaf5314abdee72fed4d86b041a3d7f87be3e554464bfb6e490eef37a267576c275aa773e6b3fcbd552c026f1e281ada2f672748b4a471e48011ebf66cbb95b6ad369f008ec711a4340280b40871335d8d534f2377299f21142020085a94e6d8cd59d40a1e9e449f36479fca5cb83683041cc15251c77d7f633025c8f3ec0a17c8c0bc00a7ee33ac803301be230dab47d29b017c9664523b271682c3ec7727ada14a9c0e58464ca8b0222a2f527c39bcf2498bc174b3b385b515791367a8eb9b83cf99b571c17afebeee5f208568b8f404c1c8219a718409541e4d27bd8dbb7ca40fb99bdd420afb585bf65045a383c7ebabb9d555065b5f5c1051774645d46cf8cbd127905f2c698f097eeee0b939e67bd48a21300ce8007c0097f20d2ba79da9790e49cad048c59e9d9a47050aeca9598304d3390d43ace624927e4acf7c86a512b9483c744a51c729bc9a1338158d79a8251c0b604afe512ee8ad3000735cc423cbf2efab5f7abe6b90741085688b8231e3e9189f39dc4f00a8c021b4751fd7e54ed748d4c69f0bab9cec6e79c0e83e8fa0ec79b11af1130198a39cde78865e58b40f70578afb6f7e6bba88aae287eee79e62b25c8fb39e0459d56963ae60c915c979ed583a65f3d36618f959cf718496b64d2a992cc7ce2a98aeccdc1de79a075b82d40b735e7831538f5c5707faef67a1e1a4c5934d6a0881f2b17de0279fbbf8aa28f214ba850fabc55e41b327a85f8c123cee4a1dae079f730b47dd22154fa412a13e5c7d35d8f81e53b0c53d852b96bc02a25abee514da085d2f32c56ae58bafb6c87fddaca20d5ef93e41186f0af167b66376e8222ea02e8776f250c4ddef43eb4683ae749ceb9baa203edf0dac6fee35a1a77e862dc74d2a9b76c3f7fe3bfb07ddad1686d3d4d32cd1c42b6ed3bb9930172c8b4a0db0cf48daa06b403b89e9862416955d10bce0b7091d510dc3b6e2333928b6981e24a79d3a4f3b2d27725238db6fbfcde325ceec4c76037401497b366984e354234b6afd1182f664f5e6b79cbba9e037b783a40d2c9eb2908b2d7511050e710800070b79fab1e11c9117e6a34f511877bc7f6bc2fb7b749d6e7f0e798ebe65d62ac3e3025c58ee93656e34f8b4f1a7a4a322e52348ce7a6a698e7140bd415bd3102a26f46b2e3c881397d52ca12b5ad5bde5557c6dc19b98e97cd1b76e7add31281bdc7b429bc1570133fa673276e7dee225ef8c08352895b7962860b7dbe8da237a96bb061658d70845461043a43ad28e7800bbf2b67cdf734c4c457e92ebb90cdd29dfa452d03e0ba1819091fb09ffcb4510838a283cbb64c526d1c0b5ef6e0ba06bf8638f3859d74fe0afab82e061624ac81e3ba2787d341e12b9819df59a102055ba1dcf8bff926c369f4d4f684559c3c5152bca8d9aecc9cb26b7dea2fc164c5a3a3e74a305c6b10283e18496a728b94815ed1ded71f012e7bcca683ed81cd14c9817efb4bbc7d11d1bfd7203ee8560814f4672d7c817d50dd856a5929b1ec151828c0a96d613101f9c21cd7120f99308638ec109e8a2ed708533fa79922afe65cf4a9a43f98131560ef5fcccd5558150ced128a3085ef233293701798b280a7a119d1d0a7d111f88828d8f505a9c80202b742bb4d6fbc169301490572913a4f0d54a08d3e55266d8ad7d4f0fd5ede71291f751626df30438b669f3ee2f0dae8b1c149697d68c533f0d49887277a855515992b5f1aecc1af53aeb8b4f431a8cc5526e1e2287a20ebc481a2b6c737810a1cd83e0854a4a2d2875403ba97a15dc6a9e8d0718041de773a8752ec7d4f90df7e63214604ffea061a1b01fa1be142718c392de9ea81680132c510292b83c082f833ae744431fb418f4ff5e9d3a0cd53d54207960e0a2b796328a6a4f4b4cc2a42f9caa63f645c0a7f2905548020773cfa3852ae065b2251f4c21dfe728d3f8dba1059c6af24357a53cf3a930fe14d7b8f8e648ce4b2910aafd7949dcf160e479d3ee1c3e80ff2ead0ee14aedda2435d653f32e291c1ef99e3162f62edcc603b4093f2c7b4756f22c1aaff1dc261575693706894c96a2d380f508a1b31057e5b06341d1b97470d5271af86bb36e2ec2e3e8c10f62c3f72ab421d9a4173d363cc428edc8a79884266077c3c2fd3c2e04bf55eeeb3c9a51f1f742ecc1b9cd83c31f6abb0f94a529dff160ec0e2fe22f3af2f3a83d91a6a27a11b2ae94ef535e2ce830ae6ed2a1ad212bbc99b9fb9e04c46816056c9908273a5344ac082e016f654484171265fbeb06018b94747ba526119f022efc7734a54dd8c05280d1cfde84fa98845bd5293d0d9af7b337823d06607eb57658f40e839c48fd96a60a73d15465fc2d82f27b9a19b5844df13eb11c42e6eda894cab333f4f1038cd1f6550975db5209a78c7988d543334fcb26be04dbf865b3a63015630a9b49d58c0a9cfacae6c4e73e89df964c343c74b4ce5603945a36c21210b61362905e696afd26a99bb53c6e445dd7a382476d9e1a45832c4ad47d8fafe3778e645c9bd2400dc4da14071b96bd4986d48448edea22b63119d224f555dff26e48fe7009e947517952b095688632a7272ffe42efbd8b429e29d4684ea9ce4812b1c14dfd1fd11af40553982e98b164fb8e0e1a997fbe8aeb06d420ae8d5020c377dede1a01f2dcbe86b878e27a664fe7825acd1090b7fec20fc9d6f20276a25bc7b1e51cdf3422013ee0d73323c1f312b0935cb31c099ba71d72f328cab864a9f9541c070dc4a1994c8fa60b4b5f88bf75761d6a463c0e9022c4873f1a6da20eee0aacee3abc1ac2815e2560fd02e7619482868acbdaab6907be0912afd969e44b71d223cb9d04162848a2dfd5413c37349a3edbd4c5696401c78cbe6d93caad7e9ab76018a11f47d46b1210aadef72b04d282a3a5808f980c9b0aeb9d6cea5e0815d11b9f9a60e1e874896b504b221399403259e89cfe7d1a6ec7a3633260596c4425b3071658bd86e4ed1a73acccd7e2ae0e7fab2ed9040fc90db411671e1f54324e9ba1140f30ee12d89265d335147a1993aec7a8387c031953cb03c6f4000a60d7d0b7dd45751c221c832ed3afe2676a2b72a37d12d60df84b7d7478c34911745f1ea44af560bd8f61dbce4e5fdad9e12376321901162cfe38b63098dd7a5038312f598b053d3308f9427135365800a47a0e7c63b6501ce4b58f3ee7be1f31317ac553f8cd73024c3d06bc27af13db3bd1f898a88b90048282ff3f8d70fb0c802852dd10d812de1822a756b349c9428a88215be9c3fd2dde1228cd03ce9ab75a15e187ca3b372ff5df4695718679c8bd033178d4427908cfca96786e5659f533fe71cbe30f1da4bc8137b3e41b41f514a4bc73997f931dd64833fdcdd71f8f38c43abbd152a2c1e07bcd72908d99d5ac5c2ddea227ad159a64eeaac62924d5310e38269934d0142067fcd187fd9d8cf61d82727339182de31f01fb9f48e4b2aefedbcef61e350f15d2d87af2b4ba8d79613ba7a801e701cadd955b70d4ff4975eefa3847426183771e9ca6ef38999c2b424e2b550e5d27f4f7c09f0f3704ab462611d3ab596281799e2c7e651537394f07070425551a3062d6f4776d163aec62a99223cfb27922f57401398610ce37b701ef7a46415c0cc02f8c745167b158c9de83c0ce85a14ab4d3fe3029c91453af591b54cbe4672b90ea245c637ec4199a995b856f37aa0fe5444f91732759410a4a42cfd30f3212753f2321936b70d2096460d694056a721b8cb9087e1c59d289889a9075e95c09415923eb019b4f1dba1a0e0ea067fb2bd51739b71102af7b4186e75b055b0d27a1874f197ce2af4e45edf6082df90dfdc06ffeaccc5d01cbd4db7376c823e4116752ef8c1c961e341e3810dfe55d6376bc549d51d91e3767eb9c0e1cce29d102d04e6d9cc49c8f0a5352d1c95d3fc683b2038a7c0899482fd306837985b13d2e686d35e70ebcb7e42c3181d03660d0301704984c33bcafe48ed7c7a9b5879a17e2ee4675850841dcd1570d120c3cf82f61a767d6bde76df42db23f9997c46f1c277530f248373e3349da9b67f56337110c455aac008e88befc0282d31cd0cf24d015c61ad0f9336cdb2b7de62e4a5d5c9d5e91f78a701919bb3297ec012a8e0a8f2dd141ca49cd88cb996a3da2b1c08d089f6920746912616493c14e61fba0205556a3765d14168725d0f89d2dbd6aad946c4f898839587ed2a342383e04721f5e1f0c5d42f20e6876b3cd6b77b488e825052f5782bb4cc8b240ecedd2c67b152986d7f49b37be20e0b6697bbb4925bc50dd240f26a8f0c37ae58478adf4551a0f68e87177100f9e0d4e541bbb9e297e86aa6cfaf27ee3c09610f1d0fcded01353b2568ba1e991a158838823d69fd2e86b5776be6c89d518422d3fffc898cb1c2e1166255e1c30e5dd349ec009c9a8c6b060f1eb386b0694d53035d8c6b7ee0b970de9ec55ec0438a31a57a863bb3010d1511536c918915d68a1a7858d9f0518d55ca82771ffcedb56759e127950591167e63c13ec88200a4a3a80ac66fdff07c67faa5c2cf0086a45dfb75a978fecd0cb9db5f6f82bd3c75b493f990fa0a1065399b861eb6b466e0454406e30de4fa8815657c329adb5648ce1f3be4e9b5602253b4b10d74c5d8a1c5169f65a2134b13ae35c0695a3daecbc4f8c5534464e1a39a2cf2ba6eca2898adcad39f42aae4f4a4f1a4ee15a414b0bee15fee5073c0a881f52836a19d7f22befced8518dcb09f3227d4bb5bab014c6abb015b7c97a011ec33a66539c630125f27d23e74f7b02a578ae9f8336337e1bfa8aa605d42f172a74ac558e19dc83d059b69fc77be8fe33f015430a5dd988e2c8883b3f0440252a96a1a0a9fcd20d337d78d63ad7bfb16133e3848f8deff78fea4b35a6d2fd1a2326c5d94ba5fd1c443a52df52f3ad02b4039b0dcfb3a10810c0badef612b52bdc511f1a582b529e8dd9c03406d09168a170647cd0f63eca191db1b8f33ae023556570c3d67113b58d095df1e7df43fa1147d6f431f587ac2fde328f3058851e512ef9ac7657de0ddf3e0a850e4f081ce2383f46f53c87dbcf6f20dd9edb1906715dcdbf4b36bbb8d5cea54d6ee15d3422b2101b4487616fe4fa0f61e7402d08e1343690d98fb3e2af8ffad5ecd8f03589c42f46c2d87833dc50d879f05aba202d6cfc4175ae5dfd3e8f68450b4ff600d384b593b4d23da2de5b207bdff9681f0f5c8a3ec9e80502473a031e152bfec0ff24e3c72db067f2b4e8c4a9c6cd6529ee156c415d799f02985b486259074eb228db1206bb58f6d34bd45f25e56680176381a12a2396ebb027d6c567a7d9c4e8a0525d6144e36237ae902d54bf97ae1dc14ab63362584fc58516429069bded05d7b01f0a993b8ee76cbc3b693df575159a53f645316fbc87d4dcd69aa771230accd0261d9951e1d2c2727be5ee972a1ab1a5781091dc6fcadc168a17355532d6862cccb2fc29863f0d2d4d5277aa94183a27258a8df3df8d40b509032ea07f4d6c10a203bfd026f18c5d14f04cccff24d9653c234ede4bc71421ba4d5afca34dcf37d13c05f2b0e588557eb542ebf529e9af3289356559e9b48682bb9e2552421deba4349c02513c9e759f4c1ef45d123e7f0f251178a617c85709051460b829963475a2cd13d9a0d45ad25ec5580517aa8e3056ca0cfbce7a5427fe4b7195993e029a811eb0b7d9bfec78b8a505992194c4e294056dd4eec140e98d8f7a729a3095b99d8b13f5a725dd803b90a77c23eb009bf475a1f79dc55f6756d52509799442bec852c9568dcf40da21db40642a775d5093e988c0eb085fcddcab067fc8f8ab235bdf586b41ffa5341e8633f5156d328fb54f6cf94b5220cebe30f17d71886354e2369bac901549c03e59c9a8215cdbe7199af0a71dd07116ec10e263703751888746b9075ddc88bd71f45d180c4ed78687209e627b31275f993dc9cf84ae5fcbf4b94ea58ca2a29102931f9228dd460ffc20a1677bdc1e3c3de65f3fbe6aad32b3ac638b9116db078b75ebd92455bfc4cbaef5ddad43951a04627a0477d0bef940cb8a91b0b298597d9cbeac0bf965ffe5b177c70752e175d534a3a7bf94b6ee8e67826b3f07372d2586f7150c3625369fc749ed41935464f2fe05a48001315f148d56004423526735a5e7a81bc278f24141c994809bea87cfcb4635c0564735831a32d1ff079d512f2891430130d84512705f0a69dbccfd222ee49c16c6b0197c44e7f80c60985bc43b5708006071459478b6822b3df3d942e236da79dba2dddc9d4283d4da189139ae355623d5595b9e28abb659d38c0e0c58b4ce2e2ade11914ebd35a74537d965b9e72721e194544065ef8e6aee58cf8b6469f119ecb60c47d079e9e1e70bc3b38757540eea9d5dfd19df934e1102c0705a4ebb321f013386fda8bc9e8102b49ed32f2c204f23e54a35896f471a4f9bc3b002d0b413e00bfc83bbea9b7f311067996d6917c1e0edde3648ccad3ba37944337a340ef82ccf8a583d37414381dc8bced9390c66ff9f9240afadb9892dfd09a37acb9891a1b79c1107e155bdd338a380b80c"))
}

#[fixture]
fn valid_plain_proof() -> Box<[u8]> {
    Box::new(hex_literal::hex!("0000000000000000000000000000000000000000000000042ab5d6d1986846cf00000000000000000000000000000000000000000000000b75c020998797da780000000000000000000000000000000000000000000000005a107acb64952eca000000000000000000000000000000000000000000000000000031e97a575e9d00000000000000000000000000000000000000000000000b5666547acf8bd5a400000000000000000000000000000000000000000000000c410db10a01750aeb00000000000000000000000000000000000000000000000d722669117f9758a4000000000000000000000000000000000000000000000000000178cbf4206471000000000000000000000000000000000000000000000000e91b8a11e7842c38000000000000000000000000000000000000000000000007fd51009034b3357f000000000000000000000000000000000000000000000009889939f81e9c74020000000000000000000000000000000000000000000000000000f94656a2ca48000000000000000000000000000000000000000000000006fb128b46c1ddb67f0000000000000000000000000000000000000000000000093fe27776f50224bd000000000000000000000000000000000000000000000004a0c80c0da527a0810000000000000000000000000000000000000000000000000001b52c2020d7462e387d31be1806682bd9795d4a8ae3506c19e907e4d72018624f7c3dbebcefa12f3bcfbe2ebf68ac234cb22ef053bfcd90544804e01e74be9b619f359d3d942d10384baa634aab94925080d29c88c8378b47a63f3662742e85618a626aba9dec1a4f90011ff7b8ab0ca22c961dfe0853d142b604bac3309ad97bb589983b445617c5bce3cce5b0980c14fcbcf5839fb9199a8233fed3fb960a205c8c92bf64c61a199a87afc59f9838c4c8b02f35840d6d0d157e001a4e54aff42834cd03054a0e59187557f6855bde567cb35ede8679cf93b804469cfd1aed183baaeae73de8094ed7be0bdab40ba71f0b5a713f468bd253f9ec6d2aa0aa50326c8365f4771f0e59187557f6855bde567cb35ede8679cf93b804469cfd1aed183baaeae73de8094ed7be0bdab40ba71f0b5a713f468bd253f9ec6d2aa0aa50326c8365f4771f0aa1378eefed989342b96e2a668c4a8aa4c595937f079d18cfb736aeb835a3ce0cb10931fdf0585655917646fd1ea925362077daa57170b461f9f0309d5aaa3b0fc7467b1aff327e148f2994594e0ced7925d979e0ae969d78f1a00dc81ac2c2189f2e18a3da3d0554ab959c76bd89e287fe9cd7c959240d7534a91909c6feea24074f6b36d6abc6b25a2b4dd39b01a3a21bf07a3965555c0649cbb1a447635101761b96675d453dcbec88a2ed8f65c4d6e0bbe6654155e915c58a05a0222059236df6b800c9d6b1ab82a3c5f421e10f246cdba4e1b527955474da8de688e96c0cf657bae067c9780ccda1f08d5f774e03c70ca3980448fbef6d1b06097716950c82505c62b40d34a7157579fa5d1f0ec3d084af1c52ad745fbb8bbab117772f1c4b3ec7f13e22ee2a8f0553da0e2af963fdf87c3e5b33c24f9cc4a705b224bb12b26e95009817a1198848673de021c79c1c48919a4fe0f485dcb8af6f840be20ee5f955b4b17784dfe4105c3b2ca8798d9b6d8e16a1402a106ef4c605e748012c8c446f1f56363c37db1635e6c1da4bb61537a1e5ed55e2bacda525a67ba73d0fa30793bc666c6e04f319e63f0517859bab9a137a42788e9bc5415f844f57220e5c7e43bfdd091851923ecaa7c71c4e32fad9c9da56f5599c532d452dc09d7d2e49dbc6dd376920ca935a91e4c43007cc0e1b89b919245e44e79c6b800d477a05979a0984330b0885047bdef9ada0cf801b3dad711532f019c4049672d76dfb238765655da7949dc7d5c1f7a258ac046cddb2ec49fa3a1ab54aab270f1665ab1b651c214c4f7378125412523417bea62b89bd2ed138850bc5a49fce15fa7dcd2e609202a36f0a3bba78cf79f98455abcbd3f0917b89acda1af4923e9d0e3aaa1677a85989f577d631257e5f491538ca881ca1d6c1a9a2814f7528ca7fff53920d0500a64a52dd195cc2b452ff25617f7038bfed8ecf86643257be82f80f748b1b906e920dc8b58afa4c704d9df06644823c73aa4e938b70b70945cdf3b7fa1d2efa506314bcc284b698d1e158fb9447ef993ece70f22b1aedac2f2c8785a99d26dadcd21d2ffebc79d090583ddc38314f6c50ee56b21f6b0c515b3ca304bda32add25bc4336ea8cbf48ef02cb95f6543ee6aee8414768eb104976cc36813eaf0a433cdc9cbf8aed6d2e67be4d8bffbf496540fef8a3754e994005bba738228610e1ae909343887b8657c22c8c49d4b00aa082aa41f6c0bc9cfcdc2a3310d7931d0ec54e041dfdec8ed4c80682eba06e8eb21066ea7e6af555a84fb0e37788072d2ecb6c1bd098b2e08d37a8b2bd0cbf9b6280567bae39f9ec936f7eff5814c922692592696138e7fd49fed4a06ee13c60b998511f863e170e391aacbc530073237ed6e5133e455dbdd76262f3edfdfff12595e48ba68aad80b36438b023f2831c2a6c55a1360e2d47a48956b432555f6cae4384d90ae82c147997c48430fb1e2b2fd91e981b12061a0bf3d0e249dd9cafdc133af4ebcf84c0fc89f916aa6cfb1087869506b05288247b101d00576bcb17ce671081c06fa7a44252da190c8a320462554ed80369625304f9eadf56bafe79f1db8991f3ba9a1f017640191f0a5e1b903fd9bb99d3d3eb01da52180643f2285111139e88c0c76f20fa0a055ff6c819050ccd6595dfb7d6e81908dbab73dd307d15f2beb4c38096ce7bfa63c1714d02c5ab9cc6aaa728778d8f35e01f09ca01fb5d86e1034bf60f2e5f019582c64a27ee1c8be988be8dcff01969a64fa2389d744ea86f082fee17228539f837c2530925234379d34675e4518b440d2468397876848cf47d9ff1a4927f003f0350212367fa2f0f629b6ca6a9f661d2fed0d5382fb6d93912d64e5e44795f41c168b51595e610684aef5e9c0a08c0072eef82fe28711eb3881da385a5ed545ae69d5922050f7a869f65e9edcffec288db9261a187f8ff95d3af00f577ec65bd77bbda0e3ab3d105868a1129a986598eb960db7cf0e6b0efb2a88ba736cdb0b4307e7b0451612c31730f9d68228c7b051833451e9fab06e268ae96f05b36a5cd0a66571f3d569e46d7324c3392d1a668c44333a7d0f6e1dbae040e1d30421301449e4e1b44458d76be69821d1a0a19a6c4ccd0183964ffca1e451aa67c696993f9b2e402afc8ed078270f722b12331e3ee520666a61af0c1f44570b1b352e112bb50c72fbb20342055fb3c9b2cbe3e19df5cf5ebd3613bc8e56b377ba4323ca62c7aa02e599aea7e89991af3e0b39e03bc78bd2ab2c814e209cc736d49e0a1eb2d8b03280849e6f6640d2815f7e24bd151f455a034d1ca8f212ddda5e40ebe5c35127d2d36503b2635b6f12306f202b6f81a349a4188842e72655ca125206c032c720e0c8140be80168ca50bb8322d5d86cfddd02eb9f5f01bc3a385e3cde870f3ec17034de30bda6cd0fa5a44a1dc62af51a3943182f2cf6d5106f440aeee2dd006ec26f62033280c3fe00180785333ff0e7333285b3729d88b0ec02f4dfca237c8a106673a27d7cd7ccc156da589834f535f62d7b8e4d652c78757624d5ce00f9ce81a49f4c86b0371f023ddcbddb8d605f6e14b8fe90444e9613eb5d05dab39081123876842b42ef2d901cfba0db420322a6ab35cf8c9088c5ebfd0d0bacea8182700a1797dff71ed5761583446835dd23323cbdd1a09e124394c1de0aa0218e7e50a75e5cf708dd856f677c05dd46c28d0fa1231b3c7185f9402d70ed719f8f9ea2eda40e1f1ecb1b7dc68e1d45458a2bbf2da496aefb7601d6f5a08337f8e47181c01691ef142aec7ce99d98ea25bffccc0e67db7de950b6b4d2347c3c8b43869249aaffd62806f9725442f8aeabf853d8aab32b999d8d42edda50945491b2a750aa1dbadffe37b27d5749a504287f8eefa37e839245cb63667085042b0da5ff01d7728708cda601901ad1bba65b42b04cb9c8700ab052f1458197c3db27843310a763687cff02252b67be544952c2b4a00a40f15cba52d0e129a691d2e70277f13cdfaa76b43314316d33cb6050da6241050c1c9046437c0f2a974ea8899071d1a9433ca3e43bc6ff4e9f061942fec36c4d363364e2bdc78fee60928de4b6f970b51fb029ac19df3fa9064d68266b6c3937c497334c57a40a870ddb67fca046a185b14488dbf8f7dffd9d0d0be756d63708152bd0577fe45fd237d9958d26a70003bd05d0732263da4d6ce35b5c76be38d29a9ca190a4fe5af2d4adfbdb6d3c711730e8bc016792e3706b7cf930960cc91617ec7fda3ad7a78caeccc4140a6af15a34850553f6ecfe0cdbbd05ab72776af5e37815b1b81bd239d7adb1690b7990d628a85420c8c9921923d310a762525b9e76f21a593eb61653c3a565be02e5622a0691f3c163476dd6b30b87ad7eb599517b19afd545a225e1e647c8bea04d726f1d83f11f3fbc749365d1c691fa594ae7079a1bd6e60c93dda1d99ca1c9ec62138f78eb78048a1be54c05b632800f8ad5916c8859700e67e6b5c4775877c31044e2534a4a926a20c59ee8e4b68c5874755d41a63b425fcd1b0f215fb6961932f69b032f75e4b716703761f0f194132f18ee05d5a8c0e9591b78f62c7dddb3626d4f0a8a4af071155c469b801bf726d83a32be8dcdad602dfc78bdf2ce9c9ba1ef34c14aa282dee8a8f38b4735e39d38b6d2fb383d599eb77e197399dbc55ee0a6e6bb1cb97a2adb62ccb451049ff83af94b2eb8b3fd89f0be031f489d3028e2632758e4f42cdf65a752a830a85078fdb791569d63c47ac0abfa32238fd63ea08b49a658139bf69c1d61355fcffd6a2c231ff3790e3a39cfc959e70e65b822a06bcf4c3ea79ee73ed7aec62eadd35f7b41a7a16c304ff6ad7aaa341e11f338114733437bdd09fae2063238036ce8cb686c583ec174fc7ed11c2bce60407ce031e2fd7b30348e9e7247bb737cec0ad491ec45092d41803fd229142a8b94bd6011593e2b479300da560022baeee1cc3f317f4241e52241818321714ada95d5c801e1e4647c4ec50166d77648c2860ee48d76c8038d0fb30b81ea736089d0676d10791a01be197b3cee6aea1cb61c05deaac265fc355d532f2036b6d628a3d39471309646be4816c3b11460712980b7f59eca54c865d99ec77d8544202d56fb9bb104caf5cb5e36d205d66939e3fa4a6dca092c7037c4d8cb37fe2e2ba5c80f2860cb0f216b425da521faeacdc5baeffb8275cf775fb97b741b7f4a811ab06c81024841236427badf5bb277e1c03537b6af0c1e6a1eeecf0dffb6e131b980c942e20c402c8883c5d4282afd097e4c34aaf7098864afb8f8d8a634385e3e61107dc136ae55c85dcdb7cffd0c17e960f01aefca9b181871d178247021a5c5ed4dc670531ebc26c1ce3112d778eb69409ef3f62276655f1d2ffae755fdef902a544a01777b5ed1ac13553ab2e2eadda10c442bbdaddc3b9a171fa9747d3a1d819d15d194715b07b7a52c98ffa3bc668229e1f7354335ab074a9ce72cc20bf3ae7a9ad03486509b2b9ec5d25d4a9d933a4b1734b9255037a840c37945e5988839186020442d45f1e8a2a56af728f9739fff9911cda52858122592d7ba9afcca18ed1450c22b2f24ec12cc3bc30f2706e43dd8e03278ece7f043e0532b1df27c84de525265d69ef29ecee3ae63a7e500b325ab4b04aabeb81ed7a48476a2792029aecae1211cd85bd836c9355b80c0f28e4e3c2aa9367b67e9c981b43b4e1e684455ff81ec99df5e72aec2a28b0ec343a6976744148ffac94abe1bdb38f717af7672da71717c7f0e86ea4a6b4e6502eab3552c5855c12da212e7d47b99c827baa262a94199d90d8c8ed54566757cad771f16d9e0a6e47e7b50eb2cc6e40191295921e0612e7798e78aba28c14a6675484de5e4f3d605e04eec39cc6ffd933ed6f8fd8290f56a8a37bc4d2240b44263c7bd9bc9ef660b1a2c459e5565faeecdf580b046f0c36d38a56bc7ebeebbe35097350f9fbc77d032649f37c59a917f5c11d843282204c1e470af141086658b53873a7536adca86cc8a573eaa376750c2fcd6ec2112a2d5d104f13e876d7969b672240107bd685fde23af0e6887fe80454b6f99fe201e88f628622cd133f637dada58b864a50cdcd3923ce5317200942705cfe74c9256203e8f8c89a05610648fdc30f4b33924209905c339fd9df4ffb8f1cf02172200e0f61e1190c33d7c318b20a989da314141ee74ef46d7c529a4e18c037706220fb7fdf91fe4d8275e392d932bee1ba35315cc1e2e790bd205394de98b3413a27f17ef493a2494d337ff1ef151c6d7ed3f55d0dada19dabac560aa9a454266c0f42ce971303bb4411cae6405a31a41c45a3980c80c191664cc9b043a2f095df2e3099768a31a4c4886c713492bc83d401c5374a1457f2fa409bb1566041b1d329d2ce5d6b33c5ee0b2210b1e4670071e10854ba902d682ea4b39d41cab90aac229e722dcbc5625412a260e40bbaf240d3761dc86cf254e48ef1a509f8dc88c9305e65bb2194d3e3f47bc18d9a871b156593f036dde477f090dce1fb5f5c67f715bc348e5e4347146b1b7a44e7a76db0d6531c6a3dfcf36eb073664d20b2b35a0740149b124a9bb522c8bd0f6defe47314ea81fde587995561296e9d255d6adf1b15afdb4833aca8e876055a6a6ea01a18b75d2970eba96eac936788491ef8922ee8bf5c8cc6ecc41112bf66ad096ad5fc1df73ba391a494f1b158cfae31da8d0ea0ea4b7b574955a8a7a9eb7a49ce9e7bdc80ebae091cb91b96cc60fe4377d926261e5f0601d35fbd58ec7e3c29986581c64811b4bf892c08d6b8ca0c9f343f036f2dd85aa094edd42f434293581da9f1d4318c4d9dfc084527e3642382aa002681f581bac8e3526f5e3dc78319119257b13b9958aeeb1e3d68949f9c4ff93213daf91febc60682047410f88a3e54ce651e39c8fd1ff80a6c3718705966721d1d4d5e171a6fb9c6251cb5806d7cb114c7e56801cf988ffdb0e61c1f08eebb8a0785959caf6d3c2e1f37f89470332c0f4b3dce7145c679b4cb7abba6863c28c618b89d45f71c985f7b29a7b6618766a597d4479b1c4459d16730f6cbba9269321585cc797f84078c4ab56def6ae470a16ac96b65a6578e49d9f6b50df2bb912d250537fc34ed6879ee293c5d7e57eac4e02a7ecaa840a1d1947313c6eb714544250537fc34ed6879ee293c5d7e57eac4e02a7ecaa840a1d1947313c6eb7145440432653a930a284387763576b56c9c21b1864f08b4e5bf4674b68f77f83be44e1552f8151a66d351b8d242e25605611496191b7de8415293d6ce621561180e411ada9b6035dec39f23e782aaa01e96b86a53226555d929a16ea41844a6d1181c04c89d855e8ca5a85446fb59a94cb03e30745917f1ecda38e23f7fe6d53b3a23018328afb446168356331f667873ff74e27a51664f4b181983c598382ab10e59271d80780f82b22c71c2ccf6fdf3781bbaac93160708e305635317a3a1d509680a98f25d81ed72ac9a1cabecca15286cd902e856fa78f473ee5a32dda20441431915595294d64458a2d4899e10ce70e18ed0f3f815b11ea4d967584cab843c9e289a59c829c90c6441b135f0f9513b85a1724905a541b30e0594303b80cefc4b302bd2f7a456341a9f025a300f5ed911633fea25986a2d3026457cb57f513d921bbf92a074524545f7d074c55c2eba8a9539d1e65b2a8328422d853437ef773f0d4bed12e7ab65a8bf50cf310d3f3eaf16fcce4989b9bc0e6694c1c933e4e9341a06e5e560285e317cc6dd2d9a4b24a4a601914f39d7bed331482dba0d11c1650f72c206b73685a108fd8931e0782580a60b5dccd6704ab20bce196bc4f480412b79c45133143dd270c91918eab1776913f62f09377557a91d119060904afc8b063c07bf5d449748a09605305534b30fc1fdc88db2111be46401e21f7680e0ec24d0f60f356a5c5da0cf2bffd9405b25d75189f4ad85731656f1f921cac5cf212cccd040070942c1411ebbe2715a5dd225318e23b657e5f5716a8b37864aba8100ef248a7c8c28208ba12b6401c4a22588957c1e5e699be61597da8744508a1611cfb8660e281bdf5c9a70d2f4edd245863af978c020245007ace82c61b2d73712d29f500e825bd8887d9361b0d8a58a19e579a84fd25415f25140541aa1a4c425fc38f6e7fdb8406a1be0dc82a15d675bd836fc3a50d9ed38449810e20caf630a2c101cb33d7e0e26becd47adbdd22f4b1c58d2fecaa8320a09eeedac2ce99c17c2563272e1cc32327365f10fd26f1b00dfb019a0652e9f81954ac95730322c170ab572275d5fffa1576b28863ffac40458e2fa5bef6bb4b145495755b3d90a07a21467b0d0b41d36e558e6e8e4f1364616d17eeb327113e120bb7fd1711d111fe8836a2dcd26ebd9ee77b404c93f3d9340dfed48ebbcf44b2c59e6498921021b50cdcd7a3c96895ebd9aa33c4f400808ff89de2d6af93836743baf8d51a818224044de1a9fd64d53a609af96390d8693470a565af59fb7aea8a3046d97f8032b81c11b02127fb8f33fe0e22c920c797e8334a427319e20b78ba75c25c38506181f8378c284a0b34680b9ed6570e905d8d7e61343dcf947b7f3a30702e7083b2f47a3233c777e9d4d3006a5a7d209696370c1556b2af4a3e0dd7740db2ae3852ce4f978b715f04d1cd4fdf153fde9690858f3ce5bb89a015a55817b1194f4e11ae484bd1ff3120693a43b6048d7ecf97e644711a3c30f6e3f882a823db0897206daf3d82e9e1e3cff9394e921309be1a5692d7a1b4d265c51e0c7165b98f138302b9d7eb3377cd1cbf2aaab133f22f385a26e7f104e9a64517f6dd8ff32dc1c1e431106016f8f531ba22a759bfd8f21e7e3751635322d468a0dfa312be711b40e0caad29639db3fba648ae6662e0ee62bfbc2a75ecd65082e23b192282a6b3c2b212cff34f0949a810c8c5ad3e40ccc79ae926a264cec1d01353d444f3c81a2262ab6050ccfc4da8647c44fe7261fc22d42a738c7f5c504c825702d013f5c841d97711979bdde13bf6a392f4bbcfffff3895c8da08079beef982923e73bf3d70608d60337dc9feefbc313bb4df926b07a7472313df38d2ec4f2493715a0ee7e105a608cb1aefe667b1f1f84830edd0c64430b810b8d6d5793a227eb9e260bc4"))
}

#[fixture]
fn valid_vk() -> [u8; VK_SIZE] {
    hex_literal::hex!("000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000001142bd66bdb7a2bc125c78e040da5a5cbe6f296ee1a11b55dce82f38413640a640d1415082e63c88eaa34836fe60428f70dee92853dc8a5d19d0bf85b0fa95ad42deae537974aa5697c77ce4f20f0fd5a3a264861cd51216bd8c56683467cd704068627460599c3db714496966bf5f4374fb6087ba1179c7a8ed5c59a1015e78406681df238df2a0f864a67847d46222c9aee090f36d34df5c2aab80f85a218f218e37167fd19d013b9c1b8da3c671ec025fe40eebc5d11d2d55e4ac8adccae27177c7a07701c29d13dc4669f3d97f847e96e4bcefe3f9cf39c6f73896b06e8212d31ea12ba12ee2338f1a638b192ffc9b995fd687c23cf6fe4a49a8e4f4c5aba2d623ef9f6f62903ac68b01fa7f3faaa5a881854d8b0a3fb6597416a145754e320b75671e0dd20da52b442fa3ce1643a24c7ac8e6059e6db24a7e1bfc51be2ac07ea8dd8b4d3fd18e2edafe7a56dfd287d677b48528aeba6bdb01913c3236ff82826602478d64dc4e23f777f35827a35ea2716bc853ad38b76968342e932d84b0c4032c3079594eb75a8449d3d5ce8bc3661650d53f9b24d923d8f404cb0bbc91084d709650356d40f0158fd6da81f54eb5fe796a0ca89441369b7c24301f8513057f9cfd5edb0e7c2c72a3c00da41d4c7c7b6d01c518c7ea0b38257198a9523027eb0839ef4980d6a98575cedc65ee5700a7148f647b842154c13fa145167b71775fbd3ba5e43163b9a8bc08ae2fdbd8e9dc005befcd8cd631818993e1437021d8011ee756abfa19e409fcb2e19a72238c07631bdde06678d3bce4455d2086f09c706e73a00d84450fb0eae1d72783faba96bc3990b1eaa86226b3574e5c43f276d401f1c0f9a2668fcae74683a84de1084739f9b1f547ec36638d7b5a1ecd912b12523f7d04a83276f3537c64334419e05b13fc20dedd7ff81c5677d3286ce2e741be4fe42cc1155a526829445f3fda95e243c4e602d1c13a77a2472f082da16a1350662e14b4ce4e8e364439d0abba02dc62a5526834f93c6db848d56dcb00563b1f480cad9069296d71489889503dda143f0b2e746ed0b6e85782c26040e20e1bb3056279dc342f6c756379f231d5f472088e4d88b5517e40b2a0133f40123ee36ecb11b62789eb4da763de77062d23ce01e2c8d1a5a6b3bd0ec93b42e770d1611c856951969fdda50b3205d5aa4486b632519d18424d0e92f60a31671d90ce97ee59d45d76230c0b534ea958de4c47e2f4c94aa3cadd7cd42e719521e0f154bdee4123a9946d2ae3eafb3800ee0eaf997cb1b074244b7337b923c097eaf0d5f22b8ade2c19f3c0953803a3a34d916eefb5bf34e2352250dd3fb63d6d8c622d2dd0a34c3a1da7c62cc30718076db1836d9e1111168b4d7ab689558c334db262c701396f0e3ae243059518c261a4137e7f6a698a26842094b80c6e88321bf172f8c6455a2bfe284b08b441d010fc2976235c0e1213cb7ef934c944e4e8374178afa12bf161e7e640beab3f563e0a2402c116a960773bd1e8b46a6a182239d21f45516c16fcb3033204ad4109fa0fbb54c4fead14c60e677f8e1897f6580570a7a5c9f897fd8dab82792c925627d7348f0bf1152efc7a0ee6a29e06296bb4d1d1934c19b595461621962d025f0fbb42467ce5caa69e812f125d20848fd1c5010e15c437db6ae7edf91438bfa5b19a7bad0f91d8971dba72882ee742a0b57f4146dc127b54505020320938baa053cd1f3dccb713a6957e0c9aa54ec21894a612d5cbdbf9edeff0d828ba063530a81a329131fb4fd19216bf0829882cdabebe61e214a8b0ce35f8e600ed91fa96cd915db4ed7fdbe73592b0b543997ac9ec27b214375d66b2db2ba7203e26ecee99e2307846f5a5eb2130b9c574c4e04e6e4772825f908ee9357e409b46a4cf0acba266c2a9b02c0ed29b2c26f8c8cbcbd82cf264ef648e67140128100429b213b9140ed25274a0f0bd3cf808a6d1bcd0d63ba0450f8716810dff987300c3bc10a892b1c1c2637db3f8fecd9d8bb38442cc46810005567f9eb3d3a97098baa0d71c65db2bf83f8a194086a4cca39916b578faf103bcf2cf468d53c71d57b5c0ab31231e12e1ce3a444583203ea04c16ec69eb20c5d6e7a8b0b14d4ed8f51217ae8af4207277f4116e0af5a9268b38a5d34910b0924c2d3fa7bd443b6244e3f29179883c120acb66ce414b5147c31531392c53007e5e59aa353dc977d4e082214179998a8086106f1eaaf33ee0b012cbd77066f132b76a71278e567595f3aaf837a72eb0ab515191143e5a3c8bd5875264866282c6b2a0de0a3fefdfc4fb4f3b8381d2c37ccc495848c2887f98bfbaca776ca390000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000206a032e44c27b0ce9ed4d186a2debd4bfe72be9bc894b742744cf102a554d06f053396ef4f905183ad76960162ff0d8c34d25b6126660c8385d13a63d2078399")
}

#[fixture]
fn valid_pubs() -> [PublicInput; 1] {
    [hex_literal::hex!(
        "0000000000000000000000000000000000000000000000000000000000000002"
    )]
}

#[rstest]
fn verify_valid_zk_proof(
    valid_vk: [u8; VK_SIZE],
    valid_zk_proof: Box<[u8]>,
    valid_pubs: [PublicInput; 1],
) {
    assert!(verify::<()>(&valid_vk, &ProofType::ZK(valid_zk_proof), &valid_pubs).is_ok());
}

#[rstest]
fn verify_valid_plain_proof(
    valid_vk: [u8; VK_SIZE],
    valid_plain_proof: Box<[u8]>,
    valid_pubs: [PublicInput; 1],
) {
    assert!(verify::<()>(&valid_vk, &ProofType::Plain(valid_plain_proof), &valid_pubs).is_ok());
}

fn get_eth_keccak_hash(data: &[u8]) -> [u8; 32] {
    // Use the Keccak variant (non-SHA3), specified for 256-bit output
    // let mut hasher = Keccak::v256();
    use tiny_keccak::{Hasher, Keccak};
    let mut hasher = Keccak::v256();
    let mut output = [0u8; 32];

    // Absorb data
    hasher.update(data);

    // Finalize hash
    hasher.finalize(&mut output);

    output
}

// fn get_sha3_256_hash(data: &[u8]) -> [u8; 32] {
//     use tiny_keccak::{Hasher, Sha3};
//     // Use Sha3::v256(), which applies the FIPS-standard padding.
//     let mut hasher = Sha3::v256();

//     hasher.update(data);

//     let mut output = [0u8; 32];
//     hasher.finalize(&mut output);

//     output
// }

#[rstest]
fn foo(valid_vk: [u8; VK_SIZE]) {
    let eth_hash = get_eth_keccak_hash(&valid_vk);

    assert_eq!(
        to_hex_string(&eth_hash),
        "0x0a1c3472f1f33e6a26c5735f3cfcfeb8247edd1c38791be7a0590fb55b01c4bd"
    );
}

mod reject {
    use super::*;
    use crate::constants::EVM_WORD_SIZE;

    //     #[rstest]
    //     fn a_zk_proof_with_non_matching_number_of_pis(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_zk_proof: [u8; ZK_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let invalid_pubs: [PublicInput; 0] = [];

    //         assert_eq!(
    //             verify::<()>(
    //                 &valid_vk,
    //                 &ProofType::ZK(Box::new(valid_zk_proof)),
    //                 &invalid_pubs
    //             )
    //             .unwrap_err(),
    //             VerifyError::PublicInputError {
    //                 message: format!(
    //                     "Provided public inputs length does not match value in vk. Expected: {}; Got: {}",
    //                     valid_pubs.len(),
    //                     invalid_pubs.len()
    //                 )
    //             }
    //         );
    //     }

    //     #[rstest]
    //     fn a_plain_proof_with_non_matching_number_of_pis(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_plain_proof: [u8; PLAIN_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let invalid_pubs: [PublicInput; 0] = [];

    //         assert_eq!(
    //             verify::<()>(
    //                 &valid_vk,
    //                 &ProofType::Plain(Box::new(valid_plain_proof)),
    //                 &invalid_pubs
    //             )
    //             .unwrap_err(),
    //             VerifyError::PublicInputError {
    //                 message: format!(
    //                     "Provided public inputs length does not match value in vk. Expected: {}; Got: {}",
    //                     valid_pubs.len(),
    //                     invalid_pubs.len()
    //                 )
    //             }
    //         );
    //     }

    //     #[rstest]
    //     fn a_zk_proof_failing_sumcheck(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_zk_proof: [u8; ZK_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let mut invalid_zk_proof = [0u8; ZK_PROOF_SIZE];
    //         invalid_zk_proof.copy_from_slice(&valid_zk_proof);
    //         invalid_zk_proof[PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 1184
    //             ..PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 1184 + EVM_WORD_SIZE]
    //             .fill(0); // Alter sumcheck_univariates[0]

    //         assert_eq!(
    //             verify::<()>(
    //                 &valid_vk,
    //                 &ProofType::ZK(Box::new(invalid_zk_proof)),
    //                 &valid_pubs
    //             )
    //             .unwrap_err(),
    //             VerifyError::VerificationError {
    //                 message: format!(
    //                     "Sumcheck Failed. Cause: Total Sum differs from Round Target Sum."
    //                 )
    //             }
    //         );
    //     }

    //     #[rstest]
    //     fn a_plain_proof_failing_sumcheck(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_plain_proof: [u8; PLAIN_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let mut invalid_plain_proof = [0u8; PLAIN_PROOF_SIZE];
    //         invalid_plain_proof.copy_from_slice(&valid_plain_proof);
    //         invalid_plain_proof[PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 0x400
    //             ..PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 0x400 + EVM_WORD_SIZE]
    //             .fill(0); // Alter sumcheck_univariates[0]

    //         assert_eq!(
    //             verify::<()>(
    //                 &valid_vk,
    //                 &ProofType::Plain(Box::new(invalid_plain_proof)),
    //                 &valid_pubs
    //             )
    //             .unwrap_err(),
    //             VerifyError::VerificationError {
    //                 message: format!(
    //                     "Sumcheck Failed. Cause: Total Sum differs from Round Target Sum."
    //                 )
    //             }
    //         );
    //     }

    //     #[rstest]
    //     fn a_zk_proof_failing_sumcheck_v2(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_zk_proof: [u8; ZK_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let mut invalid_zk_proof = [0u8; ZK_PROOF_SIZE];
    //         invalid_zk_proof.copy_from_slice(&valid_zk_proof);
    //         invalid_zk_proof[PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 0x2000
    //             ..(PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 0x2000 + 40 * EVM_WORD_SIZE)]
    //             .fill(0); // Alter sumcheck_evaluations

    //         assert_eq!(
    //             verify::<()>(&valid_vk, &ProofType::ZK(Box::new(invalid_zk_proof)), &valid_pubs).unwrap_err(),
    //             VerifyError::VerificationError {
    //                 message: format!(
    //                     "Sumcheck Failed. Cause: Grand Honk Relation Sum does not match Round Target Sum."
    //                 )
    //             }
    //         );
    //     }

    //     #[rstest]
    //     fn a_plain_proof_failing_sumcheck_v2(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_plain_proof: [u8; PLAIN_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let mut invalid_plain_proof = [0u8; PLAIN_PROOF_SIZE];
    //         invalid_plain_proof.copy_from_slice(&valid_plain_proof);
    //         invalid_plain_proof[PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 0x2000
    //             ..PAIRING_POINTS_SIZE * EVM_WORD_SIZE + 0x2000 + 40 * EVM_WORD_SIZE]
    //             .fill(0); // Alter sumcheck_evaluations

    //         assert_eq!(
    //             verify::<()>(&valid_vk, &ProofType::Plain(Box::new(invalid_plain_proof)), &valid_pubs).unwrap_err(),
    //             VerifyError::VerificationError {
    //                 message: format!(
    //                     "Sumcheck Failed. Cause: Grand Honk Relation Sum does not match Round Target Sum."
    //                 )
    //             }
    //         );
    //     }

    //     #[rstest]
    //     fn a_zk_proof_failing_shplemini_because_of_points_not_on_curve(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_zk_proof: [u8; ZK_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let field_offset = [
    //             // (ZKProofCommitmentField::W_1, 0x00),
    //             // (ZKProofCommitmentField::W_2, 0x80),
    //             // (ZKProofCommitmentField::W_3, 0x100),
    //             // (ZKProofCommitmentField::LOOKUP_READ_COUNTS, 0x180),
    //             // (ZKProofCommitmentField::LOOKUP_READ_TAGS, 0x200),
    //             // (ZKProofCommitmentField::W_4, 0x280),
    //             // (ZKProofCommitmentField::LOOKUP_INVERSES, 0x300),
    //             // (ZKProofCommitmentField::Z_PERM, 0x380),
    //             // (ZKProofCommitmentField::LIBRA_COMMITMENTS(0), 0x400),
    //             // libra_sum, 0x480
    //             // sumcheck_univariates 0x4a0, ..., 0x2420
    //             // sumcheck_evaluations 0x2440, ..., 0x2940
    //             // libra_evaluation 0x2960
    //             (ZKProofCommitmentField::LIBRA_COMMITMENTS(1), 0x2940),
    //             (ZKProofCommitmentField::LIBRA_COMMITMENTS(2), 0x29c0),
    //             (ZKProofCommitmentField::GEMINI_MASKING_POLY, 0x2a40),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(0), 0x2ae0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(1), 0x2b60),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(2), 0x2be0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(3), 0x2c60),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(4), 0x2ce0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(5), 0x2d60),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(6), 0x2de0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(7), 0x2e60),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(8), 0x2ee0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(9), 0x2f60),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(10), 0x2fe0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(11), 0x3060),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(12), 0x30e0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(13), 0x3160),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(14), 0x31e0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(15), 0x3260),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(16), 0x32e0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(17), 0x3360),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(18), 0x33e0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(19), 0x3460),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(20), 0x34e0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(21), 0x3560),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(22), 0x35e0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(23), 0x3660),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(24), 0x36e0),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(25), 0x3760),
    //             (ZKProofCommitmentField::GEMINI_FOLD_COMMS(26), 0x37e0),
    //             // gemini_a_evaluations 0x3860, ..., 0x3be0
    //             // libra_poly_evals 0x3c00, ..., 0x3c80
    //             (ZKProofCommitmentField::SHPLONK_Q, 0x3ca0),
    //             (ZKProofCommitmentField::KZG_QUOTIENT, 0x3ce0), // 0x3d20
    //         ]
    //         .map(|(cf, idx)| (cf, idx + PAIRING_POINTS_SIZE * EVM_WORD_SIZE));

    //         for (field, offset) in field_offset {
    //             let mut invalid_zk_proof = [0u8; ZK_PROOF_SIZE];
    //             invalid_zk_proof.copy_from_slice(&valid_zk_proof);
    //             // Alter current field; notice that (1, 3) ∉ G1
    //             invalid_zk_proof[offset..offset + 128].fill(0);
    //             invalid_zk_proof[offset + 31] = 1;
    //             invalid_zk_proof[offset + 64 + 31] = 3;

    //             assert_eq!(
    //             verify::<()>(&valid_vk, &ProofType::ZK(Box::new(invalid_zk_proof)), &valid_pubs).unwrap_err(),
    //             VerifyError::VerificationError {
    //                 message: format!("Shplemini Failed. Cause: Point for proof commitment field '\"{field}\"' is not on curve")
    //             });
    //         }
    //     }

    //     #[rstest]
    //     fn a_plain_proof_failing_shplemini_because_of_points_not_on_curve(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_plain_proof: [u8; PLAIN_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let field_offset = [
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(0), 0x2500),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(1), 0x2580),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(2), 0x2600),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(3), 0x2680),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(4), 0x2700),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(5), 0x2780),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(6), 0x2800),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(7), 0x2880),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(8), 0x2900),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(9), 0x2980),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(10), 0x2a00),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(11), 0x2a80),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(12), 0x2b00),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(13), 0x2b80),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(14), 0x2c00),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(15), 0x2c80),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(16), 0x2d00),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(17), 0x2d80),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(18), 0x2e00),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(19), 0x2e80),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(20), 0x2f00),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(21), 0x2f80),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(22), 0x3000),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(23), 0x3080),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(24), 0x3100),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(25), 0x3180),
    //             (PlainProofCommitmentField::GEMINI_FOLD_COMMS(26), 0x3200),
    //             (PlainProofCommitmentField::SHPLONK_Q, 0x3600),
    //             (PlainProofCommitmentField::KZG_QUOTIENT, 0x3680),
    //         ]
    //         .map(|(cf, idx)| (cf, idx + PAIRING_POINTS_SIZE * EVM_WORD_SIZE));

    //         for (field, offset) in field_offset {
    //             let mut invalid_plain_proof = [0u8; PLAIN_PROOF_SIZE];
    //             invalid_plain_proof.copy_from_slice(&valid_plain_proof);
    //             // Alter current field; notice that (1, 3) ∉ G1
    //             invalid_plain_proof[offset..offset + 128].fill(0);
    //             invalid_plain_proof[offset + 31] = 1;
    //             invalid_plain_proof[offset + 64 + 31] = 3;

    //             assert_eq!(
    //                 verify::<()>(&valid_vk, &ProofType::Plain(Box::new(invalid_plain_proof)), &valid_pubs).unwrap_err(),
    //                 VerifyError::VerificationError {
    //                     message: format!("Shplemini Failed. Cause: Point for proof commitment field '\"{field}\"' is not on curve")
    //             });
    //         }
    //     }

    //     #[rstest]
    //     fn a_zk_proof_failing_shplemini_pairing_check(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_zk_proof: [u8; ZK_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let offset = ZK_PROOF_SIZE
    //             - 2 * 0x80
    //             - FIELD_ELEMENT_SIZE * NUM_LIBRA_EVALUATIONS
    //             - FIELD_ELEMENT_SIZE * CONST_PROOF_SIZE_LOG_N; // offset for gemini_a_evaluations[0]
    //         let mut invalid_zk_proof = [0u8; ZK_PROOF_SIZE];
    //         invalid_zk_proof.copy_from_slice(&valid_zk_proof);
    //         // Alter field; notice that (1, 3) ∉ G1
    //         invalid_zk_proof[offset..offset + 128].fill(0);
    //         invalid_zk_proof[offset + 31] = 1;
    //         invalid_zk_proof[offset + 64 + 31] = 3;

    //         assert_eq!(
    //             verify::<()>(
    //                 &valid_vk,
    //                 &ProofType::ZK(Box::new(invalid_zk_proof)),
    //                 &valid_pubs
    //             )
    //             .unwrap_err(),
    //             VerifyError::VerificationError {
    //                 message: format!("Shplemini Failed. Cause: Shplemini pairing check failed")
    //             }
    //         );
    //     }

    //     #[rstest]
    //     fn a_plain_proof_failing_shplemini_pairing_check(
    //         valid_vk: [u8; VK_SIZE],
    //         valid_plain_proof: [u8; PLAIN_PROOF_SIZE],
    //         valid_pubs: [PublicInput; 1],
    //     ) {
    //         let offset = PLAIN_PROOF_SIZE - 2 * 0x80 - FIELD_ELEMENT_SIZE * CONST_PROOF_SIZE_LOG_N; // offset for gemini_a_evaluations[0]
    //         let mut invalid_plain_proof = [0u8; PLAIN_PROOF_SIZE];
    //         invalid_plain_proof.copy_from_slice(&valid_plain_proof);
    //         // Alter field; notice that (1, 3) ∉ G1
    //         invalid_plain_proof[offset..offset + 128].fill(0);
    //         invalid_plain_proof[offset + 31] = 1;
    //         invalid_plain_proof[offset + 64 + 31] = 3;

    //         assert_eq!(
    //             verify::<()>(
    //                 &valid_vk,
    //                 &ProofType::Plain(Box::new(invalid_plain_proof)),
    //                 &valid_pubs
    //             )
    //             .unwrap_err(),
    //             VerifyError::VerificationError {
    //                 message: format!("Shplemini Failed. Cause: Shplemini pairing check failed")
    //             }
    //         );
    //     }
}
